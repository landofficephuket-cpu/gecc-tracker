<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phuket Provincial Land Office GECC Tracker (Final)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        body { background-color: #f8f9fa; font-family: 'Sarabun', sans-serif; }
        .card-dashboard { border: none; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .table-hover tbody tr:hover { background-color: #f1f3f5; }
        .status-badge { min-width: 90px; }
        .nav-link { cursor: pointer; font-weight: 600; color: #6c757d; }
        .nav-link.active { color: #0d6efd !important; border-bottom: 3px solid #0d6efd; background: none; }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-primary fw-bold"><i class="fas fa-clipboard-check"></i> Phuket Provincial Land Office GECC 2569 Tracker</h2>
        <button class="btn btn-success" onclick="alert('บันทึกข้อมูลเรียบร้อย (จำลอง)')"><i class="fas fa-save"></i> บันทึกผล</button>
    </div>

    <div id="error-display" class="alert alert-danger d-none"></div>

    <div class="row g-3 mb-4" id="dashboard-container">
        </div>

    <div class="card shadow-sm">
        <div class="card-header bg-white">
            <ul class="nav nav-tabs card-header-tabs">
                <li class="nav-item"><a class="nav-link active" onclick="switchTab(1)">1. ด้านกายภาพ</a></li>
                <li class="nav-item"><a class="nav-link" onclick="switchTab(2)">2. ด้านคุณภาพ</a></li>
                <li class="nav-item"><a class="nav-link" onclick="switchTab(3)">3. ด้านผลลัพธ์</a></li>
            </ul>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th class="ps-3" style="width:10%">รหัส</th>
                            <th style="width:50%">รายการ</th>
                            <th style="width:20%">ผู้รับผิดชอบ</th>
                            <th class="text-center" style="width:20%">สถานะ</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <tr><td colspan="4" class="text-center py-5">กำลังโหลดข้อมูล...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    // ประกาศตัวแปร Global
    var currentTab = 1;
    var rawData = [];

    // ฟังก์ชันเริ่มต้น (ทำงานทันที)
    (function initSystem() {
        try {
            // 1. สร้างข้อมูล (Data Generation)
            rawData = [
                // --- หมวด 1 ---
                { id: "1.1", cat: 1, txt: "บริการนอกเวลา/พักเที่ยง", role: "ทุกฝ่าย", ok: true },
                { id: "1.2", cat: 1, txt: "ระบบขนส่งเข้าถึงง่าย", role: "ทุกฝ่าย", ok: true },
                { id: "1.3", cat: 1, txt: "ป้ายบอกทิศทางชัดเจน", role: "ทุกฝ่าย", ok: true },
                { id: "1.4", cat: 1, txt: "ผังการไหลเวียนผู้ใช้บริการ", role: "ทุกฝ่าย", ok: true },
                { id: "1.5", cat: 1, txt: "ป้ายชื่อผู้รับผิดชอบ", role: "ทุกฝ่าย", ok: true },
                { id: "1.6", cat: 1, txt: "เคาน์เตอร์เหมาะสม", role: "ทุกฝ่าย", ok: true },
                { id: "1.7", cat: 1, txt: "แสงสว่าง/ความปลอดภัย", role: "ทุกฝ่าย", ok: true },
                { id: "1.8", cat: 1, txt: "สิ่งอำนวยความสะดวก", role: "ทุกฝ่าย", ok: true },
                { id: "1.9", cat: 1, txt: "ห้องน้ำสะอาด", role: "ทุกฝ่าย", ok: true },
                { id: "1.10", cat: 1, txt: "ระบบคิวเป็นธรรม", role: "ทุกฝ่าย", ok: true },
                { id: "1.11", cat: 1, txt: "จุดคัดกรอง", role: "ทุกฝ่าย", ok: true },
                { id: "1.12", cat: 1, txt: "ผังขั้นตอนและระยะเวลา", role: "ทุกฝ่าย", ok: true },
                { id: "1.13", cat: 1, txt: "จุดประเมินความพึงพอใจ", role: "ทุกฝ่าย", ok: true },
                { id: "1.14", cat: 1, txt: "พื้นที่ปลอดบุหรี่", role: "ทุกฝ่าย", ok: true },
                { id: "1.15", cat: 1, txt: "ที่จอดรถ/สิ่งอำนวยความสะดวกผู้พิการ", role: "ทุกฝ่าย", ok: true },
                
                // --- หมวด 2 (คุณภาพ) ---
		 { id: "1.1", cat: 2, txt: "มีการจัดการภูมิทัศน์ให้เอื้ออำนวยต่อการพักผ่อนหย่อนใจของประชาชน", role: "ฝ่ายอำนวยการ", ok: true },
		{ id: "1.2", cat: 2, txt: "มีการจัดการขยะ", role: "ฝ่ายอำนวยการ", ok: true },
		{ id: "1.3", cat: 2, txt: "มีการส่งเสริมการใช้พลังงานสีเขียวหรือพลังงานทดแทน", role: "ฝ่ายอำนวยการ", ok: true },
                { id: "2.1", cat: 2, txt: "มีการสำรวจ เพื่อให้ทราบความต้องการและปัญหาการให้บริการ", role: "ฝ่ายอำนวยการ", ok: true },
                { id: "2.2", cat: 2, txt: "มีการวิเคราะห์ผลการสำรวจและนำไปออกแบบ ปรับปรุง", role: "ฝ่ายอำนวยการ", ok: true },
                { id: "2.3", cat: 2, txt: "มีงานบริการ ณ ศูนย์ราชการสะดวกครอบคลุม", role: "กลุ่มงานฯ ฝ่ายอำนวยการ", ok: false },
                { id: "2.4", cat: 2, txt: "มีการจัดทำคู่มือการปฏิบัติงานสำหรับเจ้าหน้าที่ครอบคุม", role: "ฝ่ายอำนวยการ", ok: true },
                { id: "2.5", cat: 2, txt: "มีระบบการติดตามสถานะผู้รับบริการ", role: "ฝ่ายอำนวยการ", ok: true },
                { id: "2.6", cat: 2, txt: "มีระบบและกระบวนการบริการประชาชนแบบอิเล็กทรอนิกส์", role: "ฝ่ายทะเบียน", ok: true },
                { id: "2.7", cat: 2, txt: "มีระบบรองรับการบริการไร้รอยต่อ", role: "ฝ่ายทะเบียน", ok: true },
                { id: "2.8", cat: 2, txt: "มีการนำผลจากการติดตามงานมาปรับปรุง", role: "ฝ่ายทะเบียน", ok: true },
                { id: "2.9", cat: 2, txt: "มีกลไกการรับฟังและตอบสนองข้อร้องเรียน ข้อคิดเห็น", role: "กลุ่มงานฯ", ok: true },
                { id: "2.10", cat: 2, txt: "กรณีเกิดข้อร้องเรียนการของหน่วยงานข้อร้องเรียน", role: "กลุ่มงานฯ", ok: true },
                { id: "2.11", cat: 2, txt: "มีการพัฒนาเพิ่มช่องทางการให้บริการการให้คำปรึษา", role: "ฝ่ายอำนวยการ", ok: false },
                { id: "2.12", cat: 2, txt: "มีการจัดทำแผนการติดตามผลการดำเนินการของศูนย์ราชการสะดวก", role: "ฝ่ายอำนวยการ", ok: true },
                { id: "2.13", cat: 2, txt: " มีระบบการติดตามปัญหาที่เกิดจากการให้บริการที่ชัดเจน", role: "ฝ่ายอำนวยการ", ok: true },
                { id: "2.14", cat: 2, txt: "มีการแลกเปลี่ยนเรียนรู้เกี่ยวกับปัญหาการปฏิบัติงาน", role: "ฝ่ายอำนวยการ", ok: false },
                { id: "2.15", cat: 2, txt: "การมีบูรณาการการทำงานระหว่างหน่วยงานที่เกี่ยวข้อง", role: "ฝ่ายทะเบียน", ok: true },
                { id: "2.16", cat: 2, txt: "มีการปรับปรุง/พัฒนาและกำหนดผู้รับผิดชอบระบบ call center", role: "ฝ่ายอำนวยการ", ok: true },
                { id: "2.17", cat: 2, txt: "มีแผนการบริหารความต่อเนื่องในหารให้บริการกรณีเกิดภาวะฉุกเฉิน", role: "ฝ่ายอำนวยการ", ok: false },
                { id: "2.18", cat: 2, txt: "มีการทบทวนแผนการบริหารความต่อเนื่องของหน่วยงาน", role: "ฝ่ายอำนวยการ", ok: false },
                { id: "3.1", cat: 2, txt: "มีการวิเคราะห์กำลังคนเพื่อจัดสรรบุคลากรให้เหมาะสม", role: "ฝ่ายอำนวยการ", ok: false },
                { id: "3.2", cat: 2, txt: "มีการสร้างสิ่งจุงใจแก่บุคลากร", role: "ฝ่ายอำนวยการ", ok: true },
                { id: "3.3", cat: 2, txt: "มีการเพิ่มศักยภาพและทักษะในการปฏิบัติที่จำเป็นและทันสมัย", role: "ฝ่ายอำนวยการ", ok: true },
                { id: "3.4", cat: 2, txt: "เจ้าหน้าที่มีทักษะในการให้บริการ", role: "ฝ่ายทะเบียน", ok: true },
                { id: "3.5", cat: 2, txt: "เจ้าหน้าที่สามารถปฏิบัติงานได้ตามมาตรฐานที่กำหนด", role: "ฝ่ายทะเบียน", ok: true },
                { id: "4.1", cat: 2, txt: "มีระบบจัดเก็บข้อมูลและระบบวิเคราะห์ข้อมูลครอบคุม ถูกต้อง", role: "ฝ่ายทะเบียน", ok: true },
                { id: "4.2", cat: 2, txt: "มีแผนหรือระบบการจัดการป้องกันความเสี่ยงด้านเทคโนโลยี", role: "ฝ่ายอำนวยการ", ok: true },
                { id: "4.3", cat: 2, txt: "นำนวัตกรรม/เทคโนโลยีมาประดิษฐ์", role: "ฝ่ายอำนวยการ", ok: true },
                { id: "4.4", cat: 2, txt: "มีการเก็บข้อมูลผู้ใช้บริการแบบเรียลไทม์", role: "ฝ่ายทะเบียน", ok: true },
                { id: "4.5", cat: 2, txt: "มีเจ้าหน้าที่ทางเทคนิคหรือเจ้าหน้าที่ที่ได้รับมอบหมายให้ดูแลระบบ", role: "ฝ่ายอำนวยการ", ok: false },
                { id: "5.1", cat: 2, txt: "เปิดโอกาสให้ผู้รับบริการมีส่วนร่วมในการออกแบบและปรับปรุงบริการ", role: "ฝ่ายอำนวยการ", ok: true },
                { id: "5.2", cat: 2, txt: "มีการบริการเชิงรุก หรือการออกหน่วยเคลื่อนที่", role: "กลุ่มงานฯ", ok: true },
                { id: "5.3", cat: 2, txt: "ขับเคลื่อนบริการด้วยนวัตกรรมและเทคโนโลยี", role: "ฝ่ายทะเบียน", ok: true },
                { id: "5.4", cat: 2, txt: "ความเป็นต้นแบบ", role: "ฝ่ายอำนวยการ", ok: true },
                { id: "5.5", cat: 2, txt: "มีระบบในการป้องกันการเกิดปัญหาเพื่อไม่ให้ลุกลาม", role: "ฝ่ายอำนวยการ", ok: true },
                { id: "5.6", cat: 2, txt: "การแก้ไขปัญหาเพื่อให้เข้าถึงบริการอย่างเท่าเทียม", role: "ฝ่ายอำนวยการ", ok: false },
                { id: "5.7", cat: 2, txt: "การบูรณาการการทำงานร่วมกับหน่วยงานอื่น", role: "ฝ่ายทะเบียน", ok: false },
                { id: "5.8", cat: 2, txt: "การติดต่อหน่วยงานและการตรวจสอบข้อมูลของผู้รับบริการ", role: "ฝ่ายอำนวยการ", ok: true },
                { id: "5.9", cat: 2, txt: "องค์ความรู้ของบุคลากรและการสื่อสารชัดเจน", role: "กลุ่มงานฯ", ok: true },
                { id: "5.10", cat: 2, txt: "การพัฒนาระบบดิจิทัลในงานบริการที่สำคัญ", role: "ฝ่ายทะเบียน", ok: false },

                // --- หมวด 3 ---
                { id: "O1", cat: 3, txt: "ความพึงพอใจของประชาชนในการรับบริการ", role: "ฝ่ายอำนวยการ", ok: true },
                { id: "O2", cat: 3, txt: "ความสะดวกในการติดต่อราชการ", role: "ฝ่ายอำนวยการ", ok: true },
                { id: "O3", cat: 3, txt: "การนำเทคโนโลยีมาช่วยในการให้บริการประชาชน", role: "ฝ่ายทะเบียน", ok: true }
            ];

            // 2. สั่งวาดหน้าจอทันที
            renderAll();

        } catch (e) {
            // กรณี Error ให้แสดงข้อความสีแดงบนหน้าจอ
            document.getElementById('error-display').classList.remove('d-none');
            document.getElementById('error-display').innerHTML = "เกิดข้อผิดพลาด: " + e.message;
        }
    })();

    // ฟังก์ชันวาดกราฟและตาราง
    function renderAll() {
        renderDashboard();
        renderTable();
    }

    function switchTab(catId) {
        currentTab = catId;
        // จัดการ class active ของ tab
        var tabs = document.querySelectorAll('.nav-link');
        tabs.forEach(t => t.classList.remove('active'));
        tabs[catId-1].classList.add('active');
        
        renderTable();
    }

    function toggleStatus(id) {
        var item = rawData.find(x => x.id === id);
        if(item) {
            item.ok = !item.ok;
            renderAll();
        }
    }

    function renderDashboard() {
        var stats = {
            1: { name: "ด้านกายภาพ", icon: "fa-building", total: 0, done: 0 },
            2: { name: "ด้านคุณภาพ และเงื่อนไขพิเศษ", icon: "fa-star", total: 0, done: 0 },
            3: { name: "ด้านผลลัพธ์", icon: "fa-chart-pie", total: 0, done: 0 }
        };

        // คำนวณยอด
        rawData.forEach(d => {
            if(stats[d.cat]) {
                stats[d.cat].total++;
                if(d.ok) stats[d.cat].done++;
            }
        });

        // สร้าง HTML
        var html = "";
        for(var i=1; i<=3; i++) {
            var s = stats[i];
            var percent = s.total ? Math.round((s.done/s.total)*100) : 0;
            var color = (percent === 100) ? "success" : "danger";
            
            // กรณีหมวด 2 ถ้าไม่ 100% ให้แดง
            if(i === 2 && percent < 100) color = "danger";
            else if(percent === 100) color = "success";

            html += `
                <div class="col-md-4">
                    <div class="card card-dashboard p-3 text-center border-${color}" style="border-top: 5px solid;">
                        <h5 class="text-secondary">${s.name}</h5>
                        <h2 class="display-6 fw-bold text-${color}">${percent}%</h2>
                        <small class="text-muted">เสร็จสิ้น ${s.done} / ${s.total}</small>
                    </div>
                </div>
            `;
        }
        document.getElementById('dashboard-container').innerHTML = html;
    }

    function renderTable() {
        var tbody = document.getElementById('table-body');
        var items = rawData.filter(d => d.cat === currentTab);
        
        var html = "";
        if(items.length === 0) {
            html = "<tr><td colspan='4' class='text-center'>ไม่พบข้อมูล</td></tr>";
        } else {
            items.forEach(d => {
                var btnClass = d.ok ? "btn-success" : "btn-outline-danger";
                var icon = d.ok ? "fa-check" : "fa-times";
                var statusText = d.ok ? "เสร็จสิ้น" : "ไม่เสร็จ";
                var bgRow = d.ok ? "" : "style='background-color: #fff5f5;'";

                html += `
                    <tr ${bgRow}>
                        <td class="ps-3 fw-bold text-secondary">${d.id}</td>
                        <td>${d.txt}</td>
                        <td><span class="badge bg-light text-dark border">${d.role}</span></td>
                        <td class="text-center">
                            <button class="btn ${btnClass} btn-sm status-badge" onclick="toggleStatus('${d.id}')">
                                <i class="fas ${icon} me-1"></i> ${statusText}
                            </button>
                        </td>
                    </tr>
                `;
            });
        }
        tbody.innerHTML = html;
    }
</script>

</body>

</html>

